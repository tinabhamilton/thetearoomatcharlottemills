if (self.CavalryLogger) { CavalryLogger.start_js(["ZHLh0"]); }

__d('PhotoTagApproval',['Arbiter','CSS','DOM','Event','Parent','PhotosConst','ge'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this.viewer=i;this.units=[];this.currentUnit=0;var j=i.getVersionConst();if(j==c('PhotosConst').VIEWER_SNOWLIFT){this._root=c('ge')('fbPhotoSnowliftTagApproval');}else this._root=c('ge')('fbPhotoPageTagApproval');c('Arbiter').subscribe(i.getEventString('DATA_CHANGE'),this.restartTagApproval.bind(this));c('Arbiter').subscribe('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',this.pendingTagPhotoClick.bind(this));c('Event').listen(this._root,'click',this.handleClick.bind(this));c('Event').listen(this._root,'mousemove',function(k){this.hiliteCurrentPendingTag();c('Event').kill(k);}.bind(this));this.restartTagApproval();}h.prototype.handleClick=function(event){'use strict';var i=event.getTarget();if(c('CSS').hasClass(i,'nextPager')&&c('CSS').hasClass(i,'enabled')){this.showNextUnit();}else if(c('CSS').hasClass(i,'prevPager')&&c('CSS').hasClass(i,'enabled')){this.showPrevUnit();}else if(c('Parent').byClass(i,'fbPhotoApprovalPendingButtons')){var j=this.units[this.currentUnit],k=this.getTagNameID(j);if(k){var l=c('Parent').byClass(i,'approve');c('Arbiter').inform('PhotoTagApproval.UPDATE_TAG_BOX',{id:k,approve:l,version:this.viewer.getVersionConst()});}setTimeout(this.removeSelectedUnit.bind(this),0);}return true;};h.prototype.loadUnits=function(i){'use strict';this.units=c('DOM').scry(this._root,'div.fbPhotoApprovalUnit');if(this.units.length){c('CSS').show(this._root);this.showUnit(i);c('CSS').conditionClass(this._root,'hidePagers',this.units.length==1);}else{c('CSS').hide(this._root);c('Arbiter').inform('PhotoTagApproval.HILITE_TAG',{tag:null,version:this.viewer.getVersionConst()});}};h.prototype.restartTagApproval=function(){'use strict';this.loadUnits(0);};h.prototype.pendingTagPhotoClick=function(i,j){'use strict';if(j.version!==c('PhotosConst').VIEWER_PERMALINK&&j.version!==c('PhotosConst').VIEWER_SNOWLIFT)return true;var k='approve:'+j.id;for(var l=0;l<this.units.length;l++)if(this.units[l].id===k){this.showUnit(l);return false;}return true;};h.prototype.removeSelectedUnit=function(){'use strict';var i=this.units[this.currentUnit];c('DOM').remove(i);this.loadUnits(this.currentUnit);};h.prototype.showNextUnit=function(){'use strict';this.showUnit(this.currentUnit+1);};h.prototype.showPrevUnit=function(){'use strict';this.showUnit(this.currentUnit-1);};h.prototype.getTagNameID=function(i){'use strict';var j=i.id.indexOf(':');return i.id.slice(j+1);};h.prototype.showUnit=function(i){'use strict';this.units.forEach(c('CSS').hide);this.currentUnit=(i+this.units.length)%this.units.length;var j=this.units[this.currentUnit];c('CSS').show(j);this.hiliteCurrentPendingTag();c('CSS').conditionClass(c('DOM').find(this._root,'a.prevPager'),'enabled',this.currentUnit>0);c('CSS').conditionClass(c('DOM').find(this._root,'a.nextPager'),'enabled',this.currentUnit<this.units.length-1);};h.prototype.hiliteCurrentPendingTag=function(){'use strict';var i=this.units[this.currentUnit],j=this.getTagNameID(i);c('Arbiter').inform('PhotoTagApproval.HILITE_TAG',{tag:j,version:this.viewer.getVersionConst()});};f.exports=h;},null);
__d('legacy:photo-tag-approval',['PhotoTagApproval'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();b.PhotoTagApproval=c('PhotoTagApproval');},3);
__d('PhotoPermalink',['csx','$','Arbiter','Assert','AsyncRequest','Bootloader','CSS','DOM','Event','KeyEventController','Keys','PhotoWarningScreenConfig','PageTransitions','Parent','PhotoPermalinkURI','PhotosConst','PhotoSessionLog','PhotoStreamCache','PhotosUtils','PhotoTagger','PhotoTagSearchPivotLogger','PhotoViewer','PhotoWarningScreen','PhotoWarningScreenMixin','Scroll','Style','Vector','classWithMixins','emptyFunction','ge','goURI','mixin'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('PhotoWarningScreenConfig').GraphicEvents;i=babelHelpers.inherits(l,c('classWithMixins')(c('PhotoViewer'),c('mixin')(c('PhotoWarningScreenMixin'))));j=i&&i.prototype;function l(){'use strict';j.constructor.call(this);this._uriStack=[];this.replaceUrl=false;this.payloadInitialized=false;this._seenTags={};}l.prototype.init=function(m){'use strict';this.stream=new (c('PhotoStreamCache'))();this.stream.init(c('PhotosConst').VIEWER_PERMALINK,'PhotoViewerPagelet','pagelet_photo_viewer');this.reset();this.root=c('$')('fbPhotoPageContainer');this.header=c('$')('fbPhotoPageHeader');this.stageWrapper=c('DOM').find(this.root,'.stageContainer');this.videoStage=c('DOM').find(this.stageWrapper,'div.videoStage');this.buttonActions=c('DOM').find(this.root,'div.stageButtons');this.viewLargerLink=c('DOM').scry(this.root,'a.fbPhotoViewLarger').pop();this.feedback=c('ge')('fbPhotoPageFeedback');this.image=c('ge')('fbPhotoImage');this.errorBox=c('ge')('fbPhotoPageError');this.actionList=c('ge')('fbPhotoPageActions');this.stageActions=c('DOM').find(this.root,'div.stageActions');this.photoContentContainer=c('$')('fbxPhotoContentContainer');this.photoImageStage=c('DOM').find(this.root,'.fbPhotoImageStage');this.existingPhotoWarning=c('DOM').scry(this.root,"._2v00").pop();this.initGraphicWarningDOM(this.existingPhotoWarning||m.graphic_warning_markup);this._canSeeGraphicWarning=!!m.can_see_graphic_warning;this.showingTypeaheadSuggestions=false;this.loadingStates={image:false,html:false};this.unhiliteTimer=null;this.source=null;if(this.image)this.imageLoadListener=c('Event').listen(this.image,'load',this.adjustForNewData.bind(this));this.pageHandlers=[c('Event').listen(this.root,'mouseout',this.mouseOutListener.bind(this)),c('Event').listen(this.root,'mousemove',this.mouseMoveListener.bind(this)),c('Event').listen(this.stageWrapper,'click',this.stageClickListener.bind(this)),c('Event').listen(this.buttonActions,'click',this.buttonListener.bind(this)),c('Event').listen(this.actionList,'click',this.rotateListener.bind(this)),c('Event').listen(this.feedback,'click',function(event){var n=event.getTarget();if(c('Parent').byClass(n,'like_link')||c('Parent').byClass(n,'UFILikeLink')&&c('Parent').byClass(n,'UIActionLinks'))c('CSS').toggleClass(c('DOM').find(this.buttonActions,'div.likeCommentGroup'),'viewerLikesThis');}.bind(this))];c('PageTransitions').registerHandler(this.transitionHandler.bind(this));c('KeyEventController').registerKey('LEFT',this.goNav.bind(this));c('KeyEventController').registerKey('RIGHT',this.goNav.bind(this));c('PhotoSessionLog').initLogging(c('PhotoSessionLog').PERMALINK);this._showHover=m.pivot_hover;c('Arbiter').subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));c('Arbiter').subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));this.adjustForNewData();};l.prototype.getEventPrefix=function(){'use strict';return 'PhotoPermalink';};l.prototype.getSourceString=function(){'use strict';return 'permalink';};l.prototype.getViewerSource=function(){'use strict';return this.source;};l.prototype.getViewerSet=function(){'use strict';return this.stream.getPhotoSet();};l.prototype.getVersionConst=function(){'use strict';return c('PhotosConst').VIEWER_PERMALINK;};l.prototype.getGraphicWarningContainer=function(){'use strict';return this.photoContentContainer;};l.prototype.getGraphicWarningHiddenContent=function(){'use strict';return this.photoImageStage;};l.prototype.saveTagsFromPayload=function(m){'use strict';this.storeFromData(m);if('data' in m&&this.stream.getCursor() in m.data)this.swapData();};l.prototype.goNav=function(event){'use strict';var m=c('Event').getKeyCode(event)||event.getTarget(),n=event.type==='click'&&c('Parent').byClass(m,'stageWrapper')&&!c('Parent').byClass(m,'tagBoxPending')&&!c('Parent').byClass(m,'tagBoxPendingResponse')&&!c('Parent').byClass(m,'uiButtonGroup');if(n&&c('CSS').hasClass(this.root,'taggingMode'))return false;if(m==c('Keys').LEFT){this.page(-1);}else if(m==c('Keys').RIGHT||n)this.page(1);return false;};l.prototype.pagerClick=function(m){'use strict';if(m=='prev'){this.page(-1);}else if(m=='next')this.page(1);return false;};l.prototype.setLoadingState=function(m,n){'use strict';switch(m){case l.STATE_IMAGE_DATA:this.loadingStates[m]=n;c('CSS').conditionClass(this.root,'imageLoading',n);break;case l.STATE_HTML:this.loadingStates[m]=n;c('CSS').conditionClass(this.root,'dataLoading',n);break;}};l.prototype.checkState=function(m){'use strict';if(m!=l.STATE_ERROR&&!this.loadingStates[m])return;switch(m){case l.STATE_IMAGE_DATA:var n=this.stream.getCurrentImageData();if(n){if(n.url){this.switchImage(n.url,true);}else if(n.video)this.switchVideo(n.video,true);this.setLoadingState(m,false);}break;case l.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(m,false);}break;default:if(this.stream.errorInCurrent()){if(this.image)c('CSS').hide(this.image);c('CSS').show(this.errorBox);}break;}};l.prototype.reHilitePendingTag=function(){'use strict';var m=c('ge')(this.hilitedTag);if(m&&c('CSS').hasClass(m,'showPendingTagName'))return;var n=c('DOM').scry(this.root,'div.tagsWrapper div.showPendingTagName')[0];if(n)this.switchHilitedTags(n.id);};l.prototype.setReachedLeftEnd=function(){'use strict';this.stream.setReachedLeftEnd();};l.prototype.setReachedRightEnd=function(){'use strict';this.stream.setReachedRightEnd();};l.prototype.isPagingAllowed=function(m){'use strict';return this.stream.isValidMovement(m)&&!c('CSS').hasClass(this.root,'croppingMode');};l.prototype.page=function(m,n){'use strict';if(!this.isPagingAllowed(m)||!this.stream.nonCircularPhotoSetCanPage(m))return;this._seenTags={};this.unhiliteAllTags();var o=this.getVideoOnStage();if(o)this.switchVideo(o,false);this.recacheData();this.stream.moveCursor(m);if(this.image)c('CSS').hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(l.STATE_HTML,true);c('CSS').show(this.errorBox);return;}var p=this.stream.getCurrentImageData();if(p){if(p.url){if(m!==0)if(p.info.isgraphic){if(this._canSeeGraphicWarning){this.showGraphicWarning();c('PhotoWarningScreen').logGraphic(k.GRAPHIC_PHOTO_SHOWN_WITH_WARNING);}else{this.hideGraphicWarning();c('PhotoWarningScreen').logGraphic(k.GRAPHIC_PHOTO_SHOWN_NO_WARNING);}}else this.hideGraphicWarning();this.switchImage(p.url,true);if(this.viewLargerLink)this.viewLargerLink.setAttribute('href',p.info.permalink);}else if(p.video)this.switchVideo(p.video,true);if(!n){this.replaceUrl=true;c('goURI')(p.info.permalink);}}else{this.waitForLoadCount++;this.setLoadingState(l.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(l.STATE_HTML,true);c('Arbiter').inform('PhotoPermalink.PAGE');};l.prototype.transitionHandler=function(m){'use strict';if(!c('PhotoPermalinkURI').isValid(m))return false;var n=m.getQualifiedURI().toString();if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(n);c('PageTransitions').transitionComplete();return true;}var o=this._uriStack.length;if(o>=2&&this._uriStack[o-2]===n)this._uriStack.pop();var p=this.stream.getCursorForURI(m.getUnqualifiedURI().toString());if(p){var q=this.stream.getRelativeMovement(p);this.page(q,true);c('PageTransitions').transitionComplete();return true;}return false;};l.prototype.recacheData=function(m){'use strict';if(!this.loadingStates.html){var n=this.stream.getCurrentHtml();for(var o in n){var p=c('ge')(o);if(p)n[o]=Array.from(p.childNodes);if(m!==true&&o!=='fbPhotoPageHeader'&&p)c('DOM').empty(c('$')(o));}}};l.prototype.getCurrentPhotoInfo=function(){'use strict';var m=this.stream.getCurrentImageData();return m&&m.info;};l.prototype.getVideoOnStage=function(){'use strict';var m=this.stream.getCurrentImageData();return m&&m.video;};l.prototype.switchImage=function(m,n){'use strict';c('CSS').hide(this.image);c('CSS').hide(this.errorBox);var o=this.stream&&this.stream.getCurrentImageData();if(o){c('PhotoSessionLog').addPhotoView(o.info);if(this._showHover){var p=this.stream.getCurrentExtraData();if(p)c('PhotoTagSearchPivotLogger').logImageImpression('permalink',String(this.stream.getCursor()),Object.keys(p.tagRects));}}var q=c('DOM').create('img',{id:'fbPhotoImage',className:'fbPhotoImage',alt:'',src:m});c('DOM').replace(this.image,q);this.image=q;if(this.imageLoadListener)this.imageLoadListener.remove();this.imageLoadListener=c('Event').listen(this.image,'load',this.adjustForNewData.bind(this));if(n)this.stream.preloadImages();};l.prototype.switchVideo=function(m,n){'use strict';var o='swf_'+m;if(n){c('CSS').addClass(this.stageWrapper,'showVideo');this.videoStage.id=m;if(window[o]&&!c('ge')(o))window[o].write(m);}else{this.videoStage.id='fbPageVideoStage';window[o].addVariable('video_autoplay',0);c('DOM').empty(this.videoStage);c('CSS').removeClass(this.stageWrapper,'showVideo');}};l.prototype.swapData=function(){'use strict';if(this.dataLoadTimer){this.setLoadingState(l.STATE_HTML,true);clearTimeout(this.dataLoadTimer);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,true),100);return;}var m,n=this.stream.getCurrentHtml();if(n){for(var o in n){var p=n[o];if(Array.isArray(p)&&p.length===1&&p[0]===undefined)continue;m=c('ge')(o);m&&c('DOM').setContent(m,n[o]);}c('Arbiter').inform('PhotoPermalink.DATA_CHANGE',this.stream.getCurrentImageData().info,c('Arbiter').BEHAVIOR_STATE);if(this.stream.getCurrentExtraData()){c('Arbiter').inform('PhotoPermalink.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),c('Arbiter').BEHAVIOR_STATE);var q=this.stream.getCurrentExtraData();if(q&&q.source!==undefined){this.source=q.source;c('PhotoSessionLog').setSource(this.source);}}this.setLoadingState(l.STATE_HTML,false);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,false),100);}this.adjustForNewData();};l.prototype.clearTimer=function(m){'use strict';this.dataLoadTimer=false;m&&this.swapData();};l.prototype.adjustForNewData=function(){'use strict';if(!this.image)return;var m=c('DOM').scry(this.stageWrapper,'div.tagsWrapper')[0],n=c('Vector').getElementDimensions(this.image);if(m){c('Style').set(m,'width',n.x+'px');c('Style').set(m,'height',n.y+'px');}};l.prototype.fetchInitBucket=function(m){'use strict';if(!this.stream.isLoaded())return;this.stream.fetch(m,true);};l.prototype.addPhotoFbids=function(m,n,o){'use strict';var p=this.stream.getCursor()===null;this.stream.attachToFbidsList(m,n,o);if(o&&p)this.page(0);};l.prototype.attachTagger=function(m){'use strict';c('DOM').appendContent(this.stageActions,m);};l.prototype.storeFromData=function(m){'use strict';var n=this.stream.storeToCache(m);if('init' in m){c('PhotoSessionLog').setPhotoSet(this.stream.getPhotoSet());c('PhotoSessionLog').setLogFbids(true);c('PhotoSessionLog').addPhotoView(this.stream.getCurrentImageData().info);if(this._showHover){var o=this.stream.getCurrentExtraData();if(o)c('PhotoTagSearchPivotLogger').logImageImpression('permalink',String(this.stream.getCursor()),Object.keys(o.tagRects));}}if('error' in n){this.checkState(l.STATE_ERROR);return;}if('image' in n)this.checkState(l.STATE_IMAGE_DATA);if('data' in n)this.checkState(l.STATE_HTML);if(!this.payloadInitialized&&this.stream.getCurrentExtraData()){this.payloadInitialized=true;c('Arbiter').inform('PhotoPermalink.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),c('Arbiter').BEHAVIOR_STATE);}};l.prototype.handleServerError=function(m,n){'use strict';c('DOM').setContent(this.errorBox,m);this.storeFromData(n);};l.prototype.updateTotalCount=function(m,n,o){'use strict';var p=c('ge')('fbPhotoPagePositionAndCount');p&&c('DOM').setContent(p,o);this.stream.setTotalCount(m);this.stream.setFirstCursorIndex(n);};l.prototype.buttonListener=function(event){'use strict';var m=event.getTarget();if(c('Parent').byClass(m,'likeButton')){var n=c('DOM').scry(this.feedback,'button.like_link')[0];if(!n)n=c('DOM').scry(this.feedback,'a.UFILikeLink')[0];n&&n.click();}else if(c('Parent').byClass(m,'commentButton')){var o=c('DOM').scry(this.feedback,'div.commentBox textarea')[0];if(!o)o=c('DOM').scry(this.feedback,'li.UFIAddComment textarea')[0];if(o){o.focus();c('Scroll').setTop(this.root,this.root.scrollHeight);}}};l.prototype.rotateListener=function(event){'use strict';var m=event.getTarget();if(c('Parent').byClass(m,'rotateRight')){this.rotate('right');}else if(c('Parent').byClass(m,'rotateLeft'))this.rotate('left');};l.prototype.stageClickListener=function(event){'use strict';var m=event.getTarget(),n=c('CSS').hasClass(m,'faceBox'),o=c('Parent').byClass(m,'fbPhotoTagApprovalBox')||c('Parent').byClass(m,'faceboxSuggestion')||c('Parent').byClass(m,'videoStage')||c('Parent').byClass(m,'tag')||c('Parent').byClass(m,'typeaheadWrapper')||c('Parent').byClass(m,'photoTagLink')||c('Parent').byClass(m,'photoTagTypeahead')||c('Parent').byClass(m,'fbPhotoViewLarger')||n;if(n){if(!this.showingTypeaheadSuggestions){var p=this.getTagger();p.updateWithSuggestions();setTimeout(function(){c('DOM').find(p.tagger,'input.textInput').focus();}.bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;}if(o){return true;}else this.goNav(event);};l.prototype.rotate=function(m){'use strict';var n=this.stream.getCursor();if(this.getVideoOnStage()){var o=m=='left'?270:90;c('Assert').isTruthy(this.videoRotateURI,"Video rotate URI not set.");c('Bootloader').loadModules(["VideoRotate"],function(q){new q(n,this.videoRotateURI).motionRotate(o);}.bind(this),'PhotoPermalink');return;}var p=babelHelpers['extends']({fbid:n,opaquecursor:this.stream.getOpaqueCursor(n),cs_ver:c('PhotosConst').VIEWER_PERMALINK},this.stream.getPhotoSetQuery());p[m]=1;this.setLoadingState(l.STATE_IMAGE_DATA,true);c('CSS').hide(this.image);new (c('AsyncRequest'))('/ajax/photos/photo/rotate/').setMethod('POST').setAllowCrossPageTransition(true).setReadOnly(false).setData(p).setFinallyHandler(this.rotateComplete.bind(this,n)).send();};l.prototype.rotateComplete=function(m,n){'use strict';if(m==this.stream.getCursor()){this.setLoadingState(l.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);this.swapData();}};l.prototype.mouseOutListener=function(event){'use strict';var m=event.getTarget(),n=event.getRelatedTarget(),o=c('Parent').byClass(m,'stageActions'),p=c('Parent').byClass(m,'stageWrapper'),q=c('Parent').byClass(n,'stageActions'),r=c('Parent').byClass(n,'stageWrapper'),s=c('Parent').byClass(n,'uiContextualLayer'),t=!r&&!s&&p&&!q||o&&!r;if(t)this.unhiliteAllTags(true);};l.prototype.mouseMoveListener=function(event){'use strict';var m=event.getTarget(),n=c('Parent').byClass(m,'faceboxSuggestion')||c('Parent').byClass(m,'tagPointer')||c('Parent').byClass(m,'typeaheadWrapper')||c('Parent').byClass(m,'photoTagTypeahead')||c('Parent').byClass(m,'arrow');if(!c('Parent').byClass(m,'stageActions')&&!c('Parent').byClass(m,'stageWrapper')||n)return;this.hiliteTagsOnMouseMove(event);};l.prototype.unhiliteAllTags=function(m,event){'use strict';c('DOM').scry(this.stageWrapper,'div.tagsWrapper div.hover').forEach(function(o){if(m&&c('CSS').hasClass(o,'tagBoxPending'))return;c('CSS').removeClass(o,'hover');});if(m)return;c('DOM').scry(this.stageWrapper,'div.tagsWrapper div.otherActive').forEach(function(o){c('CSS').removeClass(o,'otherActive');});if(this.unhiliteTimer!==null){clearTimeout(this.unhiliteTimer);this.unhiliteTimer=null;}this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!c('CSS').hasClass(this.root,'taggingMode')){var n=this.getTagger();if(n){n.hideTagger();n.setCurrentFacebox(null);}}};l.prototype.getTagger=function(){'use strict';return c('PhotoTagger').getInstance(c('PhotosConst').VIEWER_PERMALINK);};l.prototype.switchHilitedTags=function(m,n){'use strict';this.unhiliteAllTags();this.hiliteAllBoxes();var o=c('ge')(m);if(o){this.hilitedTag=m;if(!c('CSS').hasClass(this.root,'taggingMode')&&c('PhotosUtils').isFacebox(this.hilitedTag)){var p=this.getTagger();if(p){c('CSS').addClass(o,'hover');var q=p.getFacebox(m);p.setCurrentFacebox(q);if(q)p.addTagFromFacebox(q);}}else c('CSS').addClass(o,'hover');if(c('CSS').hasClass(o,'tagBoxPending')&&!c('CSS').hasClass(o,'showPendingTagName')&&n===true){c('DOM').scry(this.stageWrapper,'div.tagsWrapper div.showPendingTagName').forEach(function(r){c('CSS').removeClass(r,'showPendingTagName');});c('CSS').addClass(o,'showPendingTagName');}}};l.prototype.hiliteTagsOnMouseMove=function(event){'use strict';if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.unhiliteTimer!==null)return;var m=event.getTarget();if(c('Parent').byClass(m,'fbPhotoPageTagApproval')||c('Parent').byClass(m,'tagPointer'))return;var n=c('Parent').byClass(m,'tagBoxPending'),o=false;if(this.hilitedTag){var p=c('ge')(this.hilitedTag);o=p&&c('CSS').hasClass(p,'tagBoxPending');}var q=!this.hilitedTag&&n||!o&&n;if(q){this.switchHilitedTags(n.id);return;}if(n&&n.id==this.hilitedTag)return;var r=250,s=c('PhotosUtils').absoluteToNormalizedPosition(this.image,c('Vector').getEventPosition(event)),t=c('PhotosUtils').getNearestBox(this.stream.getCurrentExtraData().tagRects,s);if(!t){if(!o){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var u=null;if(o){var v={};v[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];u=c('PhotosUtils').getNearestBox(v,s);}if(u!==null&&o)return;if(this.hilitedTag!=t)if(o){this.unhiliteTimer=setTimeout(this.unhiliteAllTags.bind(this,false,event),r);}else{if(this._showHover&&!this._seenTags[t]){this._seenTags[t]=true;c('PhotoTagSearchPivotLogger').logPivotImpression('permalnk','pivot_impression',t);}this.switchHilitedTags(t);}};l.prototype.updateTagBox=function(m,n){'use strict';this.unhiliteAllTags();var o=c('ge')(m);if(!o)return;c('CSS').addClass(o,'tagBox');c('CSS').addClass(o,'tagBoxPendingResponse');c('CSS').removeClass(o,'tagBoxPending');c('CSS').hide(c('DOM').find(o,'span.tagForm'));if(n){c('CSS').show(c('DOM').find(o,'span.tagApproved'));}else c('CSS').show(c('DOM').find(o,'span.tagIgnored'));};l.prototype.reset=function(){'use strict';while(this.pageHandlers&&this.pageHandlers.length)this.pageHandlers.pop().remove();if(this.imageLoadListener){this.imageLoadListener.remove();this.imageLoadListener=null;}c('KeyEventController').getInstance().resetHandlers();};l.prototype.onHiliteTag=function(m,n){'use strict';if(n.version!=c('PhotosConst').VIEWER_PERMALINK)return;var o=n.tag;if(o){this.switchHilitedTags(o,true);}else this.unhiliteAllTags();};l.prototype.onUpdateTagBox=function(m,n){'use strict';if(n.version==c('PhotosConst').VIEWER_PERMALINK)this.updateTagBox(n.id,n.approve);};l.prototype.setHasLocation=function(m){'use strict';c('CSS').conditionClass(this.root,'hasLocation',m);};l.getInstance=function(){'use strict';if(!l._instance)l._instance=new l();return l._instance;};l.addPhotoFbids=function(m,n,o){'use strict';l.getInstance().addPhotoFbids(m,n,o);};l.setReachedLeftEnd=function(){'use strict';l.getInstance().setReachedLeftEnd();};l.setReachedRightEnd=function(){'use strict';l.getInstance().setReachedRightEnd();};l.attachTagger=function(m){'use strict';l.getInstance().attachTagger(m);};l.disableAjaxPipeForVideo=function(){'use strict';var m=l.getInstance();if(m.stream)m.stream.setUseAjaxPipe(false);};l.init=function(m){'use strict';l.getInstance().init(m||{});};l.recacheData=function(m){'use strict';l.getInstance().recacheData(m);};l.saveTagsFromPayload=function(m){'use strict';l.getInstance().saveTagsFromPayload(m);};l.saveTagsFromPayloadDelayed=function(m){'use strict';setTimeout(l.saveTagsFromPayload.bind(null,m),2000);};l.handleServerError=function(m,n){'use strict';l.getInstance().handleServerError(m,n);};l.setHasLocation=function(m){'use strict';l.getInstance().setHasLocation(m);};l.storeFromData=function(m){'use strict';l.getInstance().storeFromData(m);};l.swapData=function(){'use strict';l.getInstance().swapData();};l.updateTotalCount=function(m,n,o){'use strict';l.getInstance().updateTotalCount(m,n,o);};l.setVideoRotateURI=function(m){'use strict';l.getInstance().videoRotateURI=m;};Object.assign(l,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_DATA:'image',MIN_TAG_DISTANCE:80,_instance:null,touchMarkup:c('emptyFunction')});f.exports=l;},null);
__d('PhotoPermalinkTagger',['Arbiter','Event','PhotoPermalink','PhotoTagger','$'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('PhotoTagger'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,c('PhotoPermalink').getInstance(),true);this.photoData=k;}j.prototype.setupHandlers=function(){'use strict';var k=c('$')('imagestage'),l=c('$')('fbPhotoPageTagBoxes');this.handlers=[c('Event').listen(this.clickState,'click',this.addTag.bind(this)),c('Event').listen(k,'click',this.addTag.bind(this)),c('Event').listen(l,'click',this.addTag.bind(this)),c('Event').listen(this.addTagLink,'click',this.checkActions.bind(this)),c('Event').listen(this.overlayActions,'click',this.checkActions.bind(this))];this.subscriptions=[c('Arbiter').subscribe('PhotoPermalink.PAGE',this.restartTagging.bind(this)),c('Arbiter').subscribe('PhotoPermalink.DATA_CHANGE',this.setPhotoData.bind(this)),c('Arbiter').subscribe('PhotoPermalink.EXTRA_DATA_CHANGE',this.setExtraData.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));};j.prototype.setDataForTokenizer=function(){'use strict';this.tokenizer.setup(null,this.photoData);return this;};Object.assign(j.prototype,{elemNames:{0:{addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons'}}});f.exports=j;},null);
__d('legacy:PhotoPermalinkTagger',['PhotoPermalinkTagger'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();b.PhotoPermalinkTagger=c('PhotoPermalinkTagger');},3);
__d('legacy:fb-photos-permalink-js',['PhotoPermalink'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();b.PhotoPermalink=c('PhotoPermalink');},3);
__d('PhotoTags',['csx','cx','Arbiter','CSS','DOM','Event','Parent','PhotosConst','ge'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k,l,m){'use strict';this.tagTargets=k;this.tagBox=l;this.version=m||c('PhotosConst').VIEWER_PERMALINK;this.handlers=[];this.tagTargets.forEach(function(n){this.handlers.push(c('Event').listen(n,{mouseover:this.showTag.bind(this),mouseout:this.hideTags.bind(this)}));}.bind(this));this.subscriptions=[];if(this.version==c('PhotosConst').VIEWER_SNOWLIFT)this.subscriptions.push(c('Arbiter').subscribe("PhotoSnowlift.PAGE",this.hideTags.bind(this)));}j.prototype.showTag=function(event){'use strict';var k=event.getTarget(),l=c('CSS').hasClass(k,'taggee'),m=c('CSS').matchesSelector(k,"._54ru"),n=null,o=null;if(l){n=k.getAttribute('data-tag');o=k.getAttribute('data-tagtype');}else if(m){var p=c('Parent').byTag(k,'a');n=p&&p.getAttribute('data-tag');}if(!n){k=c('Parent').byClass(k,'taggee');if(k){n=k.getAttribute('data-tag');o=k.getAttribute('data-tagtype');}}var q=this.version==c('PhotosConst').VIEWER_PERMALINK?'perm:tag:'+n:'tag:'+n,r=q&&c('ge')(q);if(r){if(o==='product'){c('CSS').addClass(r,'hover');}else c('CSS').addClass(r,'showTag');c('CSS').addClass(this.tagBox,'showingTag');}};j.prototype.hideTags=function(){'use strict';c('CSS').removeClass(this.tagBox,'showingTag');c('DOM').scry(this.tagBox,'div.showTag').forEach(function(k){c('CSS').removeClass(k,'showTag');});c('DOM').scry(this.tagBox,'div.hover').forEach(function(k){c('CSS').removeClass(k,'hover');});};j.prototype.destroy=function(){'use strict';for(var k in this.handlers)this.handlers[k].remove();this.subscriptions.forEach(c('Arbiter').unsubscribe.bind(c('Arbiter')));};f.exports=j;},null);
__d('legacy:PhotoTags',['PhotoTags'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();b.PhotoTags=c('PhotoTags');},3);
__d('TagToken',['DOM','Token'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('Token'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this,k,'tag');}j.prototype.createElement=function(){'use strict';var k=this.isFreeform(),l=c('DOM').create('span',{className:'separator'},', '),m=c('DOM').create(k?'span':'a',{className:'taggee','data-tag':this.getValue()},this.getText());if(!k)m.href=this.getInfo().path;return c('DOM').create('span',{className:'tagItem'},[l,m]);};f.exports=j;},null);
__d('TagTokenizer',['fbt','Arbiter','CSS','DOM','Parent','TagToken','Tokenizer','createObjectFrom','ge','getElementText'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('Tokenizer'));j=i&&i.prototype;function k(l,m,n,o,p){'use strict';j.constructor.call(this,n,o,p);c('Arbiter').subscribe('PhotoInlineEditor.CANCEL_INLINE_EDITING',this.updateTokenareaVisibility.bind(this),c('Arbiter').SUBSCRIBE_NEW);this.appphoto=m;c('Arbiter').subscribe(l.getInstance().getEventString('DATA_CHANGE'),this.setup.bind(this),c('Arbiter').SUBSCRIBE_NEW);}k.prototype.setup=function(l,m){'use strict';this.appphoto=m.byapp;this.byowner=m.isowner;return this.reset();};k.prototype.reset=function(){'use strict';var l=this.getTokenElements().map(this.getTokenDataFromTag.bind(this));this.withTagKeys={};var m=this.getWithTagTokenElements().map(function(n){return this._tokenKey(this.getTokenDataFromTag(n));}.bind(this));this.withTagKeys=c('createObjectFrom')(m);return j.reset.call(this,l);};k.prototype.processEvents=function(event,l,m){'use strict';if(c('Parent').byClass(l,'remove')){var n=this.getTokenFromElement(m);n=this.addTokenData(n,l);this.removeToken(n);event.kill();}};k.prototype.insertToken=function(l){'use strict';return null;};k.prototype.removeToken=function(l){'use strict';if(this.appphoto){return this.replaceToken(l);}else{this.inform('removeToken',l);c('Arbiter').inform('Form/change',{node:this.element});}};k.prototype.addTokenData=function(l,m){'use strict';if(c('Parent').byClass(m,'blockuser'))l.blockUser=true;return l;};k.prototype.getTokenDataFromTag=function(l){'use strict';return {uid:c('DOM').find(l,'input').value,text:c('getElementText')(c('DOM').find(l,'.taggee'))};};k.prototype.getTokenElementFromTarget=function(l){'use strict';return c('Parent').byClass(l,'tagItem');};k.prototype.getTokenElements=function(){'use strict';return c('DOM').scry(this.tokenarea,'span.tagItem').filter(this.filterNonTokenElements.bind(this));};k.prototype.getWithTagTokenElements=function(){'use strict';return c('DOM').scry(this.tokenarea,'span.withTagItem');};k.prototype.filterNonTokenElements=function(l){'use strict';return !c('CSS').hasClass(l,'markasspam')&&!c('CSS').hasClass(l,'reported')&&!c('CSS').hasClass(l,'withTagItem');};k.prototype.createToken=function(l,m){'use strict';var n=this.getToken(this._tokenKey(l));n=n||new (c('TagToken'))(l);m&&n.setElement(m);return n;};k.prototype.updateTokenareaVisibility=function(){'use strict';var l=this.getTokenElements().filter(function(o){return c('CSS').shown(o);}),m=this.getWithTagTokenElements(),n=c('DOM').scry(this.tokenarea,'span.ogTagItem');c('CSS').conditionShow(this.tokenarea,l.length!==0||m.length!==0||n.length!==0);};k.prototype.replaceToken=function(l){'use strict';if(!l)return;var m=this.tokens.indexOf(l);if(m<0)return;this.tokens.splice(this.tokens.indexOf(l),1);delete this.unique[this._tokenKey(l.getInfo())];var n=c('ge')('tagspam'+l.getValue());n&&c('DOM').remove(n);var o=[' [',h._("Tag Removed."),' '];o.push(c('DOM').create('a',{onclick:this.markAsSpam.bind(this,l.getValue())},h._("Mark tag as spam")));o.push('] ');var p=c('DOM').create('span',{className:'fbPhotosTaglistTag tagItem markasspam',id:'tagspam'+l.getValue()},o);c('DOM').replace(l.getElement(),p);this.updateTokenarea();this.inform('removeToken',l);c('Arbiter').inform('Form/change',{node:this.element});};k.prototype.markAsSpam=function(l){'use strict';var m=c('ge')('tagspam'+l),n=[' [',h._("Tag Reported"),'] '],o=c('DOM').create('span',{className:'fbPhotosTaglistTag tagItem reported',id:'tagspam'+l},n);c('DOM').replace(m,o);this.inform('markTagAsSpam',l);};f.exports=k;},null);
__d('HideInlineHelp',['DynamicIconSelector','SelectorDeprecated'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=[],i={registerMenu:function(j,k,l){h[j]=k.setValue.bind(k,l);},registerLegacyMenu:function(j,k,l){h[j]=function(){c('SelectorDeprecated').setSelected(k,l);c('DynamicIconSelector').swapIcon(k);};},registerAsyncPopoverMenu:function(j,k,l){h[j]=function(){var m=k.getMenu();m.setValue(l);};},triggerUndo:function(j){h[j]();}};f.exports=i;},null);
__d('VideoEncodeFeedbackInactivityTimer',['ArbiterMixin','mixin'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this.$VideoEncodeFeedbackInactivityTimer1=0;this.$VideoEncodeFeedbackInactivityTimer2=k;this.$VideoEncodeFeedbackInactivityTimer3=null;}j.prototype.start=function(){'use strict';clearTimeout(this.$VideoEncodeFeedbackInactivityTimer3);this.$VideoEncodeFeedbackInactivityTimer3=setTimeout(function(){this.inform('inactive',this.$VideoEncodeFeedbackInactivityTimer1);this.$VideoEncodeFeedbackInactivityTimer1++;}.bind(this),this.$VideoEncodeFeedbackInactivityTimer2);};j.prototype.reset=function(){'use strict';this.$VideoEncodeFeedbackInactivityTimer1=0;this.start();};j.prototype.stop=function(){'use strict';clearTimeout(this.$VideoEncodeFeedbackInactivityTimer3);this.$VideoEncodeFeedbackInactivityTimer3=null;};f.exports=j;},null);
__d('VideoEncodeFeedbackProgressBar',['fbt','Arbiter','AsyncRequest','ChannelConstants','CSS','DOM','OptimisticVideoPostUtils','ReloadPage','VideoEncodeFeedbackInactivityTimer'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){'use strict';this.$VideoEncodeFeedbackProgressBar1=j.config;this.$VideoEncodeFeedbackProgressBar2=j.error_box;this.$VideoEncodeFeedbackProgressBar3=j.progress_bar;this.$VideoEncodeFeedbackProgressBar4=j.processing_message;this.$VideoEncodeFeedbackProgressBar5=j.video_id;this.$VideoEncodeFeedbackProgressBar6=null;this.init();}i.prototype.init=function(){'use strict';this.$VideoEncodeFeedbackProgressBar6=new (c('VideoEncodeFeedbackInactivityTimer'))(this.$VideoEncodeFeedbackProgressBar1.inactivity_timeout);c('Arbiter').subscribe(this.$VideoEncodeFeedbackProgressBar7(this.$VideoEncodeFeedbackProgressBar5),this.$VideoEncodeFeedbackProgressBar8.bind(this));this.$VideoEncodeFeedbackProgressBar6.subscribe('inactive',this.$VideoEncodeFeedbackProgressBar9.bind(this));this.$VideoEncodeFeedbackProgressBar6.start();};i.prototype.$VideoEncodeFeedbackProgressBar10=function(){'use strict';this.$VideoEncodeFeedbackProgressBar3.setPosition(0);};i.prototype.$VideoEncodeFeedbackProgressBar7=function(){'use strict';return c('ChannelConstants').getArbiterType('video_encode');};i.prototype.$VideoEncodeFeedbackProgressBar8=function(event,j){'use strict';if(j.obj.videoID!=this.$VideoEncodeFeedbackProgressBar5)return;this.$VideoEncodeFeedbackProgressBar6.reset();var k=j.obj.progress,l=j.obj.extra,m=j.obj.error;if(m){this.$VideoEncodeFeedbackProgressBar11(m,l.is_permanent_error);return;}if(k==100)this.$VideoEncodeFeedbackProgressBar12(0);this.$VideoEncodeFeedbackProgressBar3.setTarget(k,l.time_left||0);};i.prototype.$VideoEncodeFeedbackProgressBar9=function(j){'use strict';this.$VideoEncodeFeedbackProgressBar13();this.$VideoEncodeFeedbackProgressBar6.start();};i.prototype.$VideoEncodeFeedbackProgressBar13=function(){'use strict';c('OptimisticVideoPostUtils').checkVideoStatus(this.$VideoEncodeFeedbackProgressBar5,function(j){this.$VideoEncodeFeedbackProgressBar12(this.$VideoEncodeFeedbackProgressBar1.manual_refresh_delay);}.bind(this),function(j,k){this.$VideoEncodeFeedbackProgressBar11(k.error,true);}.bind(this),function(j){this.$VideoEncodeFeedbackProgressBar3.changeLabel(this.$VideoEncodeFeedbackProgressBar4);this.$VideoEncodeFeedbackProgressBar6.reset();}.bind(this));};i.prototype.$VideoEncodeFeedbackProgressBar12=function(j){'use strict';this.$VideoEncodeFeedbackProgressBar3.changeLabel(h._("Finalizing video..."));this.$VideoEncodeFeedbackProgressBar3.setPosition(100);c('ReloadPage').delay(j);};i.prototype.$VideoEncodeFeedbackProgressBar11=function(j,k){'use strict';if(!k){this.$VideoEncodeFeedbackProgressBar10();this.$VideoEncodeFeedbackProgressBar3.changeLabel(h._("Video processing failed. Retrying..."));return;}this.$VideoEncodeFeedbackProgressBar6.stop();c('CSS').hide(this.$VideoEncodeFeedbackProgressBar3.getRoot());c('DOM').setContent(this.$VideoEncodeFeedbackProgressBar2,j);c('DOM').appendContent(this.$VideoEncodeFeedbackProgressBar3.getRoot().parentNode,this.$VideoEncodeFeedbackProgressBar2);};f.exports=i;},null);
__d('VideoChainingToken',['Base64'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this.$VideoChainingToken1=i;}h.prototype.decode=function(){'use strict';return JSON.parse(c('Base64').decode(this.$VideoChainingToken1));};f.exports=h;},null);